# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task -l

  submodules:init:
    desc: Initialize and update git submodules
    cmds:
      - git submodule update --init --recursive
  
  git:commit-push:
    desc: 'Commit all changes and push (usage: go-task git:commit-push -- "message")'
    vars:
      MSG: '{{.CLI_ARGS}}'
    preconditions:
      - sh: '[ -n "{{.MSG}}" ]'
        msg: "Commit message required. Usage: task git:commit-push -- \"message\""
    cmds:
      - |
        set -e
        for dir in mcp extension; do
          if [ -d "$dir/.git" ]; then
            if ! git -C "$dir" diff --quiet || ! git -C "$dir" diff --cached --quiet; then
              git -C "$dir" add -A
              git -C "$dir" commit -m "{{.MSG}} ($dir)"
              git -C "$dir" push
            fi
          fi
        done
      - |
        set -e
        git add -A
        if ! git diff --cached --quiet; then
          git commit -m "{{.MSG}}"
          git push
        else
          echo "No root changes to commit."
        fi

  mcp:run:
    desc: Run MCP server
    dir: ./mcp
    cmds:
      - go run ./cmd/mcp

  mcp:build:
    desc: Build MCP binary
    dir: ./mcp
    cmds:
      - go build -o ./target/SurferMcp ./cmd/mcp

  ext:dev:
    desc: Run extension dev server
    dir: ./extension
    cmds:
      - pnpm install
      - pnpm dev
